<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëŒ€íšŒ í˜„ì¬ ë“±ìˆ˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 16px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    .updated {
      text-align: right;
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
      text-align: center;
      font-size: 14px;
    }
    th {
      background: #222;
      color: #fff;
    }
    tr:nth-child(even) td {
      background: #fafafa;
    }
    .name {
      text-align: left;
    }
    .small {
      font-size: 12px;
      color: #999;
    }
  </style>
</head>
<body>
  <h1>í˜„ì¬ ë“±ìˆ˜</h1>
  <div class="updated" id="updated">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <table>
    <thead>
      <tr>
        <th>ìˆœìœ„</th>
        <th>ì´ë¦„</th>
        <th>ì´í•©</th>
      </tr>
    </thead>
    <tbody id="rank-body">
      <!-- JSë¡œ ì¤„ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </tbody>
  </table>
  <p class="small">â€» 10ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ë„ ë©ë‹ˆë‹¤.</p>

  <script>
    // ğŸ‘‰ ì—¬ê¸°ë§Œ ë„¤ "rank" ì‹œíŠ¸ì˜ CSV ì£¼ì†Œë¡œ ë°”ê¿”ì£¼ë©´ ë¨
    const RANKINGS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTqsmOlxzgGxrh91wGE0b92x3x40Ta1ZT2l0yd6rTKq5HsrZSng3qocNXwmypouA5F6H68HV46GPVHJ/pub?gid=0&single=true&output=csv";

    async function loadRanking() {
      try {
        const res = await fetch(RANKINGS_CSV_URL + "&cachebuster=" + Date.now());
        const text = await res.text();

        // CSV â†’ í–‰/ì—´ë¡œ ìª¼ê°œê¸°
        const rows = text
          .trim()
          .split(/\r?\n/)
          .map(line => line.split(","));

        // rows[0] : 1í–‰ (1ìˆœ/2ìˆœ í° ì œëª©)  â†’ ë²„ë¦¼
        // rows[1] : 2í–‰ (ì´ë¦„/ìˆœìœ„/ì´í•©/1ì‹œ/2ì‹œ/â€¦) â†’ ë²„ë¦¼
        const dataRows = rows.slice(2);

        // [ { name, total }, ... ] ë¡œ ë³€í™˜
        const items = dataRows
          .map(cols => {
            // Aì—´ì€ ë¹„ì–´ìˆê³ , Bì—´ì´ ì´ë¦„ / Dì—´ì´ ì´í•©
            const name  = (cols[1] ?? "").trim();      // Bì—´
            const total = Number((cols[3] ?? "0").trim()); // Dì—´
            return { name, total };
          })
          .filter(item => item.name !== "" && !Number.isNaN(item.total));

        // ì´í•© ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        items.sort((a, b) => b.total - a.total);

        const tbody = document.getElementById("rank-body");
        tbody.innerHTML = "";

        items.forEach((item, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${idx + 1}</td>
            <td class="name">${item.name}</td>
            <td>${item.total}</td>
          `;
          tbody.appendChild(tr);
        });

        const updated = document.getElementById("updated");
        const now = new Date();
        updated.textContent =
          "ë§ˆì§€ë§‰ ê°±ì‹ : " +
          now.toLocaleTimeString("ko-KR", { hour12: false });
      } catch (e) {
        console.error(e);
        document.getElementById("updated").textContent =
          "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    loadRanking();
    // 10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
    setInterval(loadRanking, 10000);
  </script>
</body>
</html>